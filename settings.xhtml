<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	template="/WEB-INF/templates/default.xhtml"
	xmlns:p="http://primefaces.org/ui">
	<ui:define name="content">
		<h:outputStylesheet name="css/backEnd/element/table.css" />
		<h:outputStylesheet name="css/backEnd/element/paginator.css" />
		<h:outputStylesheet name="css/backEnd/element/item-filter.css" />
		<h:outputStylesheet name="css/backEnd/element/button.css" />

		<h:outputStylesheet name="css/backEnd/settings.css" />
		<h:outputStylesheet name="css/backEnd/settings-rooms.css" />

		<h:outputScript name="js/backEnd/settings.js" />
		<p:tabView id="tabView" styleClass="tabView">
			<p:tab id="mainTab" title="#{common.main}"
				titleStyleClass="mainTab tab">
				<h:form id="settingsForm">
				<p:growl id="growl" showDetail="true" sticky="false"/>
					<div class="saveSettingsWrapper">
						<p:commandButton value="#{common.save}"
							actionListener="#{settingController.save}" ajax="false"
							styleClass="mainSave" />
					</div>
					<table class="settingsTable">
							<thead class="globalHeader">
								<tr>
									<th>
										<div class="debugTitle">#{common.debug}</div>
											<p:selectBooleanCheckbox value="#{settingController.settings.debug}" styleClass="debugCheckBox">
											<p:ajax event="change"/>
											</p:selectBooleanCheckbox>
									</th>
									<th></th>
								</tr>
							</thead>
							<tbody class="contentWrapper">
							<tr>
								<td>#{common.debugEmails}</td>
								<td><h:inputText id="debugEmails"
										value="#{settingController.settings.debugEmails}"
										required="false" converter="debugEmailsConverter" validator="debugEmailValidator">
									</h:inputText>
									<p:message for="debugEmails" display="text"/>
								</td>
							</tr>
							</tbody>
					
					
					
					
						<!-- GENERAL-->
						<thead class="globalHeader">
							<tr>
								<th>#{common.settings_general}</th>
								<th></th>
							</tr>
						</thead>
						<tbody class="contentWrapper">
							<tr>
								<td>#{common.admin_email}</td>
								<td><h:inputText id="adminEmail"
										value="#{settingController.settings.adminEmail}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.application_time_zone}</td>
								<td><h:inputText id="applicationTimeZone"
										value="#{settingController.settings.applicationTimeZone}"
										required="true">
										<f:validateLongRange minimum="-12" maximum="14" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.mail_time_zone}</td>
								<td><h:inputText id="mailTimeZone"
										value="#{settingController.settings.mailTimeZone}"
										required="true">
									</h:inputText></td>
							</tr>
						</tbody>

						<!-- SMTP-->
						<thead class="globalHeader">
							<tr>
								<th>SMTP</th>
								<th></th>
							</tr>
						</thead>
						<tbody class="contentWrapper">
							<tr>
								<td>#{common.smtp_domain}</td>
								<td><h:inputText id="smtpDomain"
										value="#{settingController.settings.smtpDomain}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.smtp_login}</td>
								<td><h:inputText id="smtpLogin"
										value="#{settingController.settings.smtpLogin}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.smtp_password}</td>
								<td><h:inputSecret id="smtpPassword" redisplay="true"
										value="#{settingController.settings.smtpPassword}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputSecret></td>
							</tr>
						</tbody>

						<!-- URLS-->
						<thead class="globalHeader">
							<tr>
								<th>URLS</th>
								<th></th>
							</tr>
						</thead>
						<tbody class="contentWrapper">
							<tr>
								<td>#{common.main_app_url}</td>
								<td><h:inputText id="mainAppUrl"
										value="#{settingController.settings.mainAppUrl}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.static_res_url}</td>
								<td><h:inputText id="staticResourcesUrl"
										value="#{settingController.settings.staticResourcesUrl}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.att_root_url}</td>
								<td><h:inputText id="attachmentRootUrl"
										value="#{settingController.settings.attachmentRootUrl}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.ava_root_url}</td>
								<td><h:inputText id="avatarRootUrl"
										value="#{settingController.settings.avatarRootUrl}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.exchange_server_url}</td>
								<td><h:inputText id="exchangeServerUrl"
										value="#{settingController.settings.exchangeServerUrl}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
						</tbody>

						<!-- ATTACHMENTS-->
						<thead class="globalHeader">
							<tr>
								<th>#{common.settings_attachments}</th>
								<th></th>
							</tr>
						</thead>
						<tbody class="contentWrapper">
							<tr>
								<td>#{common.allowed_shared_folder}</td>
								<td><h:inputText id="attachmentSharedFolder"
										readonly="true"
										value="${settingController.settings.attachmentSharedFolder}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.temporaryFolder}</td>
								<td><h:inputText id="temporaryFolder"
										value="#{settingController.settings.temporaryFolder}"
										required="true">
										<f:validateLength maximum="255" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.att_file_types}</td>
								<td><p:autoComplete id="attachmentFileTypes"
										styleClass="fileTypes"
										value="#{settingController.settings.attachmentFileTypes}"
										completeMethod="#{settingController.attachmentFileTypesComplete}"
										multiple="true">
										<p:ajax event="itemSelect"
											listener="#{settingController.handleAttachmentFileTypesSelect}" />
										<p:ajax event="itemUnselect"
											listener="#{settingController.handleAttachmentFileTypesUnselect}" />
									</p:autoComplete></td>
							</tr>
							<tr>
								<td>#{common.att_max_size_mb}</td>
								<td><h:inputText id="attachmentFileMaxSize"
										value="#{settingController.settings.attachmentFileMaxSize}"
										required="true">
										<f:validateLongRange minimum="1" />
									</h:inputText></td>
							</tr>
						</tbody>
						<!-- CRON-->
						<thead class="globalHeader">
							<tr>
								<th>CRON<h:commandLink id="startCronNow"
										styleClass="startNowLink" value="#{common.startNow}"
										action="#{settingController.startCronNow}" /></th>
								<th></th>
							</tr>
						</thead>
						<tbody class="contentWrapper">
							<tr>
								<td>#{common.clear_temp_dir_cron_expression}</td>
								<td><h:inputText id="clearTempDirCronExpression"
										value="#{settingController.settings.clearTempDirCronExpression}"
										required="false">
										<f:validator validatorId="cronValidator" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.evening_mail_cron_expression}</td>
								<td><h:inputText id="eveningCronExpression"
										value="#{settingController.settings.cronExpression}"
										required="false">
										<f:validator validatorId="cronValidator" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.published_events_mail_cron_expression}</td>
								<td><h:inputText id="published_eventsCronExpression"
										value="#{settingController.settings.newPublishedEventsCronExpression}"
										required="false">
										<f:validator validatorId="cronValidator" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.invite_feedback_cron_expression}</td>
								<td><h:inputText id="feedback_eventsCronExpression"
										value="#{settingController.settings.feedbackCronExpression}"
										required="false">
										<f:validator validatorId="cronValidator" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>Cron expression to notify about closed invite</td>
								<td>
								<div class="cronExpress">
								<p:selectOneMenu id="cronInterval"
										styleClass="cronExpression"
										value="#{settingController.interval}">
										<f:selectItem itemLabel="Every day" itemValue="* * *" />
										<f:selectItem itemLabel="Every week" itemValue="* *" />
										<f:selectItem itemLabel="Every hour" itemValue="* * * *" />
										<p:ajax event="change" update=":tabView:settingsForm:dayExpression :tabView:settingsForm:hoursExpression"/>
									</p:selectOneMenu> 
										<h:outputText value="Hour: " styleClass="labelExpression" />
									<p:selectOneMenu id="hoursExpression"
										styleClass="hoursExpression" value="#{settingController.hours}" disabled="#{!settingController.visibleHour}">
										<f:selectItem itemLabel="10" itemValue="10" />
										<f:selectItem itemLabel="12" itemValue="12" />
										<f:selectItem itemLabel="16" itemValue="16" />
										<f:selectItem itemLabel="18" itemValue="18" />
										<f:selectItem itemLabel="20" itemValue="20" />
										<f:selectItem itemLabel="22" itemValue="22" />
									</p:selectOneMenu> 
										<h:outputText value="Day: " styleClass="labelExpression" disabled="#{!settingController.visibleDay}"/>
									<p:selectOneMenu id="dayExpression"
										styleClass="hoursExpression" value="#{settingController.day}" disabled="#{!settingController.visibleDay}">
										<f:selectItem itemLabel="Sun" itemValue="Sun" />
										<f:selectItem itemLabel="Mon" itemValue="Mon" />
										<f:selectItem itemLabel="Tue" itemValue="Tue" />
										<f:selectItem itemLabel="Wed" itemValue="Wed" />
										<f:selectItem itemLabel="Thu" itemValue="Thu" />
										<f:selectItem itemLabel="Fri" itemValue="Fri" />
										<f:selectItem itemLabel="Sat" itemValue="Sat" />

									</p:selectOneMenu>
								</div>
									</td>
							</tr>
						</tbody>
						<ui:remove>
							<thead class="globalHeader">
								<tr>
									<th>LOCATIONS <ui:remove>
											<h:commandLink id="synchronizeLocationsLink"
												styleClass="startNowLink" value="SYNCHRONIZE LOCATIONS!"
												action="#{settingController.synchronizeLocations}" />
										</ui:remove>
									</th>
									<th></th>
								</tr>
							</thead>
							<tbody class="contentWrapper">
								<!-- LOCATION -->
								<tr>
									<td>Available locations</td>
									<td><ul>
											<ui:repeat var="l"
												value="#{locationBackingBean.availableLocations}"
												varStatus="status">
												<li><div class="titleValue clearLeft">
														<p:inplace editor="true" toggleable="true"
															styleClass="editableField">
															<h:inputText value="#{l.name}"
																styleClass="titleEditor inlineEditor">
															</h:inputText>
															<p:ajax event="save"
																onsuccess="document.location.reload()" />
														</p:inplace>
													</div></li>
											</ui:repeat>
										</ul></td>
								</tr>
							</tbody>
						</ui:remove>
						<!-- OTHER-->
						<thead class="globalHeader">
							<tr>
								<th>#{common.settings_other}</th>
								<th></th>
							</tr>
						</thead>
						<tbody class="contentWrapper">
							<tr>
								<td>#{common.settings_event_type}</td>
								<td>
								<p:autoComplete id="eventTypes"
										styleClass="fileTypes"
										value="#{settingController.eventTypes}" 
										completeMethod="#{settingController.eventTypesComplete}" 
										multiple="true" >
										<p:ajax event="itemSelect"
											listener="#{settingController.handleEventTypesSelect}" />
										<p:ajax event="itemUnselect"
											listener="#{settingController.handleEventTypesUnselect}" update="growl eventTypes"/>
											
									</p:autoComplete>
								</td>
							</tr>
							<tr>
								<td>#{common.startTrainingTime}</td>
								<td><p:calendar id="startTrainingTime"
										title="#{common.chooseTime}"
										locale="#{languageBackingBean.obtainLocale()}"
										value="#{settingController.settings.startTrainingTime}"
										readonlyInput="true" pattern="HH:mm" timeOnly="true"
										maxMinute="45" stepMinute="15" /></td>
							</tr>
							<tr>
								<td>#{common.endTrainingTime}</td>
								<td><p:calendar id="endTrainingTime"
										title="#{common.chooseTime}"
										locale="#{languageBackingBean.obtainLocale()}"
										value="#{settingController.settings.endTrainingTime}"
										readonlyInput="true" pattern="HH:mm" timeOnly="true"
										maxMinute="45" stepMinute="15" /></td>
							</tr>
							<tr>
								<td>#{common.frequency_update_outlook}</td>
								<td><h:inputText id="frequencyUpdateOutlook"
										value="#{settingController.settings.frequencyUpdateOutlook}"
										required="true">
										<f:validateLongRange minimum="1" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.minEventsForNotification}</td>
								<td><h:inputText id="minEventsForNotification"
										value="#{settingController.settings.minEventsForNotification}"
										required="true">
										<f:validateLongRange minimum="1" maximum="40" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.maxTimeDelayForNotification}</td>
								<td><h:inputText id="maxTimeDelayForNotification"
										value="#{settingController.settings.maxTimeDelayForNotification}"
										required="true">
										<f:validateLongRange minimum="1" maximum="24" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.outlook_info_update_period}</td>
								<td><h:inputText id="outlookInfoUpdatePeriod"
										value="#{settingController.settings.outlookInfoUpdatePeriod}"
										required="true">
										<f:validateLongRange minimum="1" maximum="60" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.search_fields}</td>
								<td><p:selectManyCheckbox id="searchFields"
										styleClass="searchFields" layout="pageDirection"
										value="#{settingController.settings.searchFields}"
										style="border-style: none">
										<f:selectItems value="#{settingController.searchFields}" />
									</p:selectManyCheckbox></td>
							</tr>
							<tr>
								<td>#{common.tree_expandLevel}</td>
								<td><h:inputText id="expandLevel"
										value="#{settingController.settings.expandLevel}"
										required="true">
										<f:validateLongRange minimum="0" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.events_per_page}</td>
								<td><h:inputText id="eventsPerPage"
										value="#{settingController.settings.eventNumberPerPage}"
										required="true">
										<f:validateLongRange minimum="3" />
									</h:inputText></td>
							</tr>
							<tr>
								<td>#{common.location_management}</td>
								<td><div class="loc_buttons">
									<p:commandButton styleClass="black-button float-left"
										actionListener="#{locationManagement.synchronizeLocations}"
										value="#{common.locations_sync}"
										onstart="enableAjaxProgress('.settingsTable')"
										immediate="true" ajax="false" />
									<p:commandButton styleClass="black-button float-left"
										actionListener="#{roomManagement.updateCache}"											
										value="#{common.room_cache_update}"
										onstart="enableAjaxProgress('.settingsTable')"
										immediate="true" ajax="false" />
									<p:commandButton styleClass="black-button float-left"
									 	actionListener="#{roomManagement.synchronizeAllRooms}"
										value="#{common.rooms_sync}"
										onstart="enableAjaxProgress('.settingsTable')"
										immediate="true" ajax="false" />
								</div></td>
							</tr>
						</tbody>
					</table>
				</h:form>
			</p:tab>
			<!-- MAIL TEMPLATES -->
			<p:tab id="mailTamplatesTab" title="#{common.mail_templates}"
				titleStyleClass="mailTamplatesTab tab">
				<h:form id="mailTemplatesForm">
					<p:accordionPanel id="accordeonPanel" styleClass="accordeonPanel"
						activeIndex="-1" value="#{mailTemplateBean.mailTemplates}"
						var="template">
						<p:tab titleStyleClass="accordeonTab"
							title="#{template.description}">
							<p:panelGrid id="display" style="width: 100%">
								<p:row>
									<p:column ><h:outputText value="#{common.subject}" /></p:column>
									<p:column><h:inputText size="70" id="subject" value="#{template.subject}"
										styleClass="subjectInput" /></p:column>
								</p:row>
								<p:row>
									<p:column><h:outputText value="#{common.theres_list_predef_vars}" /></p:column>
									<p:column><p:inputTextarea id="variables" style="width:95%" rows="10"
										readonly="true" value="#{template.variables}" /></p:column>
								</p:row>
								<p:row>
									<p:column colspan="2">
										<p:editor id="mailBody" width="930" height="500"
											value="#{template.body}" />
									</p:column>
								</p:row>
							</p:panelGrid>
							<div class="saveMailTamplatesWrapper">
								<p:commandButton action="#{mailTemplateBean.save(template)}"
									value="#{common.save}" styleClass="mailTamplateSave" />
							</div>
						</p:tab>
					</p:accordionPanel>
				</h:form>
			</p:tab>

			<!-- LOCATIONS MANAGEMENT -->
			<p:tab id="locationsManagement"
				title="#{common.locations_management}"
				titleStyleClass="mailTamplatesTab tab">
				<h:form id="locationsForm">
					<p:dataTable id="locationList"
						styleClass="tableClass locationsTable"
						value="#{locationManagement.allLocations}" var="item"
						paginator="true" widgetVar="locationsTable"
						paginatorPosition="bottom" sortBy="#{item.key.enabled}"
						lazy="true" emptyMessage="#{common.no_records_found}" rows="10"
						rowsPerPageTemplate="10,20,30">
						<f:facet name="header">
							<ui:remove>
								<p:commandButton styleClass="black-button float-left "
									action="#{locationManagement.synchronizeLocations}"
									disabled="false" value="#{common.locations_sync}"
									onstart="enableAjaxProgress('.locationsTable tbody')"
									oncomplete="location.reload();" />
							</ui:remove>
							<div id="keywordFilter" onkeypress="disableReturnKeyPress();">
								<p:inputText id="globalFilter" styleClass="keywordFilter"
									onkeyup="quickSearchKeyUp({input: this, searchFoo: filterSearch, tableVar: locationsTable});" />
							</div>
							<p:watermark for="globalFilter"
								value="#{common.room_quick_search}" />
							<div class="progressHeaderBackground roomProgresContainer" />
						</f:facet>
						<p:column headerText="#{common.room_name}" width="350"
							styleClass="roomTableColumnHead" sortBy="#{item.key.name}"
							filterBy="#{item.key.name}" filterStyle="display: none">
							<h:outputText id="name" value="#{item.key.name}"
								styleClass="underlined #{item.key.disabled ? 'hidden' :''}" />
							<p:tooltip for="name" id="addressTooltipId"
								styleClass="addressTooltip addAddress"
								value="#{item.value.size() == 0 ? 
       						'Could not find any addresses in this location.' : 
       					 	item.value}" />
						</p:column>
						<p:column headerText="#{common.room_email}" width="350"
							sortBy="#{item.key.email}" styleClass="roomTableColumnHead">
							<h:outputText value="#{item.key.email}"
								styleClass="#{item.key.disabled ? 'hidden' :''}" />
						</p:column>
						<p:column headerText="#{common.location_status}" width="110"
							styleClass="roomTableColumnHead" sortBy="#{item.key.enabled}">
							<h:form id="disableForm">
								<p:selectBooleanCheckbox value="#{item.key.enabled}"
									onchange="toggle_hidden($(this))">
									<p:ajax event="change"
										update=":tabView:roomsForm:roomList:locationFilter"
										listener="#{locationManagement.saveLocation(item.key)}"
										onstart="enableAjaxProgress('.locationsTable tbody')"
										oncomplete="disableAjaxProgress('.locationsTable tbody');" />
								</p:selectBooleanCheckbox>
							</h:form>
						</p:column>
						<p:column width="40" styleClass="roomTableColumnHead">
							<div class="addressesButtonWrapper">
								<p:commandButton id="addressesButton"
									styleClass="edit-sprite #{item.key.disabled ? 'hidden' :''}"
									action="#{locationManagement.newAddressLocation(item.key)}"
									oncomplete="addressesAddDialog.show();"
									update=":tabView:addressesDialog" />
								<p:tooltip for="addressesButton" id="addAddressTooltipId"
									styleClass="addressTooltip" value="Add new address to location" />
							</div>
						</p:column>
						<p:ajax event="page"
							onstart="enableAjaxProgress('.locationsTable tbody')"
							oncomplete="disableAjaxProgress('.locationsTable tbody')" />
						<p:ajax event="sort"
							onstart="enableAjaxProgress('.locationsTable tbody')"
							oncomplete="disableAjaxProgress('.locationsTable tbody')" />
						<p:ajax event="filter"
							onstart="enableAjaxProgress('.locationsTable tbody')"
							oncomplete="disableAjaxProgress('.locationsTable tbody')" />
					</p:dataTable>
					<div class="itemPerPageBottom">
						<h:outputText id="itemNumberLocationBottom"
							class="itemsPerPageText"
							value="#{common.items_per_page_showing} #{locationManagement.allLocations.numberOfLocations} #{common.items_per_page_showing_of} #{locationManagement.allLocations.rowCount} #{common.items_per_page_showing_items}" />
						<p:commandButton id="itemNumberLocationUpdater"
							style="display:none;" widgetVar="itemNumberLocationUpdater"
							value="" update=":tabView:locationsForm:itemNumberLocationBottom" />
						<span class="itemsPerPageText">#{common.items_per_page}</span>
						<p:selectOneMenu styleClass="selectItemsPerPageBottom"
							value="#{locationManagement.lazyModel.pageSize}"
							widgetVar="selectVarBottomFirstTab">
							<f:selectItem itemLabel="10" itemValue="10" />
							<f:selectItem itemLabel="20" itemValue="20" />
							<f:selectItem itemLabel="30" itemValue="30" />
							<p:ajax event="change"
								onstart="enableAjaxProgress('locationsTable');itemPerPageSelectSetting('locationsTable', true);"
								oncomplete="itemNumberLocationUpdater.jq.click(); disableAjaxProgress('locationsTable');"></p:ajax>
						</p:selectOneMenu>
					</div>
				</h:form>
				<p:dialog id="addressesDialog"
					header="#{common.addresses_header} (#{locationManagement.addAddressLocation.name})"
					widgetVar="addressesAddDialog" modal="true" resizable="false"
					styleClass="addAddressToLocation">
					<h:form id="addAddressForm">
						<div class="autocompleteContainer">
							<h:outputLabel value="#{common.new_addresses}" styleClass="title" />
							<p:inputText id="address"
								value="#{locationManagement.addAddressName}" required="true"
								validator="#{locationManagement.validateAddress}"
								onkeypress="disableAction()" />
							<p:message id="addressValidationMessage" for="address"
								display="text" />
							<h:outputLabel value="#{common.saved_addresses}"
								styleClass="title savedAddressesLabel" />
							<p:panel id="noAddressesFoundPanel">
								<h:outputText styleClass="noItemsFound"
									rendered="#{locationManagement.locationAddresses.size() == 0}"
									value="#{common.no_saved_addresses_found}" />
							</p:panel>
							<h:panelGroup id="userDialogTable" layout="block"
								styleClass="selectedAddresses">
								<ui:repeat value="#{locationManagement.locationAddresses}"
									var="address">
									<div class="addressBuble">
										<h:outputText value="#{address.address}" />
										<p:commandButton
											action="#{locationManagement.deleteAddress(address)}"
											value="x"
											update=":tabView:addAddressForm:noAddressesFoundPanel :tabView:addAddressForm:userDialogTable"
											immediate="true" />
									</div>
								</ui:repeat>
							</h:panelGroup>
						</div>
						<div class="dialogFooter">
							<div>
								<p:commandButton id="saveAddressButton"
									actionListener="#{locationManagement.addAddress}"
									value="#{common.location_address_save}"
									update="@form :tabView:locationsForm:locationList :tabView:addAddressForm:userDialogTable" />
							</div>
							<div>
								<p:commandButton value="#{common.close}"
									onclick="addressesAddDialog.hide();"
									actionListener="#{locationManagement.addAddressClear()}"
									immediate="true" update="@form" />
							</div>
						</div>
					</h:form>
					<p:ajax event="close" update=":tabView:addAddressForm"
						listener="#{locationManagement.addAddressClear()}" />
				</p:dialog>
			</p:tab>


			<!-- ROOMS MANAGEMENT -->
			<p:tab id="roomsManagement" title="#{common.rooms_management}"
				titleStyleClass="mailTamplatesTab tab">
				<h:form id="roomsForm">
					<p:dataTable id="roomList" value="#{roomManagement.lazyModel}"
						styleClass="tableClass roomsTable" widgetVar="roomsTable"
						var="room" rows="10" rowIndexVar="rowIndex" paginator="true"
						lazy="true" editable="true" paginatorPosition="bottom"
						sortBy="#{room.enabled}" sortOrder="descending" emptyMessage="#{common.no_records_found}"
						rowsPerPageTemplate="10,20,30">
						<f:facet name="header">
							<p:commandButton ajax="true" value="#{common.room_create}"
								styleClass="black-button float-left" onclick="CRD.show();" />
							<div id="keywordFilter" onkeypress="disableReturnKeyPress();">
								<p:inputText id="globalFilter" styleClass="keywordFilter"
									onkeyup="quickSearchKeyUp({input: this, searchFoo: filterSearch, tableVar: roomsTable});" />
							</div>

							<div id="item-filter" class="inlineBlocks">
								<p:selectOneMenu styleClass="item-filter" id="locationFilter"
									value="#{roomManagement.selectedLocation}"
									converter="locationConverter">
									<f:selectItem itemLabel="All locations" />
									<f:selectItems value="#{roomManagement.allAvailableLocations}"
										var="location"
										itemLabel="#{location.name} #{ location.disabled ? ' (disabled)' : ''}"
										itemValue="#{location}" />
									<p:ajax event="change" update="roomList"
										onstart="enableAjaxProgress('.roomsTable tbody');"
										oncomplete="disableAjaxProgress('.roomsTable tbody');"></p:ajax>
								</p:selectOneMenu>
							</div>

							<p:watermark for="globalFilter"
								value="#{common.room_quick_search}" />
							<div class="progressHeaderBackground roomProgresContainer">
							</div>
						</f:facet>

						<p:column headerText="#{common.room_name}" sortBy="#{room.name}"
							styleClass="roomTableColumnHead #{room.enabled ? '': 'hidden'}"
							filterBy="#{room.name}" width="150" filterStyle="display: none">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{room.name}" />
								</f:facet>
								<f:facet name="input">
									<p:inputText value="#{room.name}"
										onkeypress="rowEditKeyPress(#{rowIndex})" />
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{common.room_email}" sortBy="#{room.email}"
							styleClass="roomTableColumnHead #{room.enabled ? '': 'hidden'}"
							filterBy="#{room.email}" width="200" filterStyle="display: none">
							<h:outputText value="#{room.email}" />
						</p:column>

						<p:column headerText="#{common.room_capacity}" width="70"
							sortBy="#{room.capacity}" filterBy="#{room.capacity}"
							styleClass="roomTableColumnHead #{room.enabled ? '': 'hidden'}"
							filterStyle="display: none">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{room.capacity}" />
								</f:facet>
								<f:facet name="input">
									<p:inputText value="#{room.capacity}"
										styleClass="capacityInput"
										onkeypress="rowEditKeyPress(#{rowIndex})" />
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{common.room_location}" width="100"
							sortBy="#{room.location}"
							styleClass="roomTableColumnHead #{room.enabled ? '': 'hidden'}">
							<h:outputText
								value="#{room.location.name}#{room.location.disabled ? ' (Disabled)' : ''}" />
						</p:column>

						<p:column headerText="#{common.location_address}" width="180"
							sortBy="#{room.address}"
							styleClass="roomTableColumnHead #{room.enabled ? '': 'hidden'}">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{room.address.address}" />
								</f:facet>
								<f:facet name="input">
									<p:selectOneMenu value="#{room.address}"
										converter="addressConverter">
										<f:selectItem itemLabel="#{common.location_address_select}" />
										<f:selectItems
											value="#{roomManagement.getAvailableAddress(room.location)}"
											var="adr" itemLabel="#{adr.address}" itemValue="#{adr}" />
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{common.location_status}" width="80"
							styleClass="roomTableColumnHead" sortBy="#{room.enabled}">
							<h:form id="disableRoomForm">
								<p:selectBooleanCheckbox value="#{room.enabled}"
									onchange="toggle_row($(this))">
									<p:ajax event="change"
										listener="#{roomManagement.updateRoom(room)}"
										onstart="enableAjaxProgress('.roomsTable tbody')"
										oncomplete="disableAjaxProgress('.roomsTable tbody');" />
								</p:selectBooleanCheckbox>
							</h:form>
						</p:column>

						<p:column width="15" styleClass="roomTableColumnHead"
							style="height:28px;">
							<p:rowEditor id="roomEditor" />
							<ui:remove>
								<p:commandButton styleClass="deleteButton" value=""
									onclick="if (!confirm('#{common.room_delete_confirm}')) return false"
									actionListener="#{roomManagement.deleteRoomById(room.id)}"
									update=":tabView:roomsForm"></p:commandButton>
							</ui:remove>
						</p:column>

						<p:ajax event="rowEdit" listener="#{roomManagement.onEdit}"
							onstart="enableAjaxProgress('.roomsTable tbody')"
							oncomplete="disableAjaxProgress('.roomsTable tbody')" />
						<p:ajax event="page"
							onstart="enableAjaxProgress('.roomsTable tbody')"
							oncomplete="disableAjaxProgress('.roomsTable tbody')" />
						<p:ajax event="sort"
							onstart="enableAjaxProgress('.roomsTable tbody')"
							oncomplete="disableAjaxProgress('.roomsTable tbody')" />
						<p:ajax event="filter"
							onstart="enableAjaxProgress('.roomsTable tbody')"
							oncomplete="disableAjaxProgress('.roomsTable tbody')" />
					</p:dataTable>
					<div class="itemPerPageBottom">
						<h:outputText id="itemNumberRoom" class="itemsPerPageText"
							value="#{common.items_per_page_showing} #{roomManagement.numberOfRows} #{common.items_per_page_showing_of} #{roomManagement.lazyModel.rowCount} #{common.items_per_page_showing_items}" />
						<span class="itemsPerPageText">#{common.items_per_page}</span>
						<p:selectOneMenu styleClass="selectItemsPerPageBottom"
							widgetVar="selectVarBottomSecondTab"
							value="#{roomManagement.lazyModel.pageSize}">
							<f:selectItem itemLabel="10" itemValue="10" />
							<f:selectItem itemLabel="20" itemValue="20" />
							<f:selectItem itemLabel="30" itemValue="30" />
							<p:ajax event="change" update=":tabView:roomsForm:itemNumberRoom"
								onstart="enableAjaxProgress('.roomsTable tbody'); itemPerPageSelectSetting('roomsTable', false);"
								oncomplete="disableAjaxProgress('.roomsTable tbody');"></p:ajax>
						</p:selectOneMenu>
					</div>
				</h:form>


				<p:dialog id="createRoomDialog" widgetVar="CRD" modal="true"
					header="Create room dialog" styleClass="addDialog" dynamic="true"
					resizable="false">
					<h:form id="createRoomDialogForm">
						<div class="autocompleteContainer">
							<h:outputLabel for="newRoomName" value="#{common.room_name}"
								styleClass="title" />
							<p:inputText id="newRoomName" value="#{roomManagement.name}"
								required="true">
								<f:validateLength minimum="3" />
							</p:inputText>
							<p:message for="newRoomName" display="text" />

							<h:outputLabel for="newRoomEmail" value="#{common.room_email}"
								styleClass="title" />
							<p:inputText id="newRoomEmail" value="#{roomManagement.email}"
								validator="#{roomManagement.validateEmail}" required="true" />
							<p:message for="newRoomEmail" display="text" />

							<h:outputLabel for="newRoomCapacity"
								value="#{common.room_capacity}" styleClass="title" />
							<p:inputText id="newRoomCapacity"
								value="#{roomManagement.capacity}">
								<f:validateLongRange minimum="0" maximum="200" />
							</p:inputText>
							<p:message for="newRoomCapacity" display="text" />

							<h:outputLabel for="newRoomLocation"
								value="#{common.room_location}" styleClass="title" />
							<p:selectOneMenu id="newRoomLocation"
								value="#{roomManagement.location}" converter="locationConverter">
								<f:selectItem itemLabel="#{common.location_select}" />
								<f:selectItems value="#{roomManagement.availableLocation}"
									var="loc" itemLabel="#{loc.name}" itemValue="#{loc}" />
								<p:ajax event="change"
									update="@this :tabView:createRoomDialogForm:newRoomAddress"
									onstart="$('.newRoomAddress').addClass('ui-state-disabled');"
									oncomplete="$('.newRoomAddress').removeClass('ui-state-disabled');" />
							</p:selectOneMenu>
							<p:message for="newRoomLocation" display="text" />

							<h:outputLabel for="newRoomAddress"
								value="#{common.location_address}" styleClass="title" />
							<p:selectOneMenu id="newRoomAddress"
								value="#{roomManagement.address}" converter="addressConverter"
								styleClass="newRoomAddress">
								<f:selectItem itemLabel="#{common.location_address_select}" />
								<f:selectItems
									value="#{roomManagement.getAvailableAddress(roomManagement.location)}"
									var="adr" itemLabel="#{adr.address}" itemValue="#{adr}" />
							</p:selectOneMenu>
						</div>

						<ui:remove>
							<p:messages id="msgs" />

							<p:blockUI block=":tabView:createRoomDialog" widgetVar="CRDLock">
								<p:graphicImage
									value="#{staticPath}/resources/img/AjaxLoader.gif" />
							</p:blockUI>
						</ui:remove>

						<div class="progressHeaderBackground" />

						<div class="dialogFooter">
							<div>
								<p:commandButton id="roomSave" value="#{common.room_save}"
									actionListener="#{roomManagement.createRoomSave}"
									update=":tabView:createRoomDialogForm"
									oncomplete="if (args.isValid) {CRD.hide();}" />
							</div>
							<div>
								<p:commandButton value="#{common.cancel}" onclick="CRD.hide();" />
							</div>
						</div>
					</h:form>
					<p:ajax event="close" listener="#{roomManagement.createRoomClear}"
						update=":tabView:createRoomDialogForm :tabView:roomsForm"></p:ajax>
				</p:dialog>

			</p:tab>
		</p:tabView>
		<h:outputText value="#{common.setting_updated}"
			rendered="#{settingController.saved}" style="color: green;" />
	</ui:define>

</ui:composition>
